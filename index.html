<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paralegal Task Deconstruction Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: var(--secondary-color);
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            height: 100%;
        }
        
        .card h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .input-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .task-input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .task-input-container label {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        textarea {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
        }
        
        .examples {
            margin-top: 15px;
        }
        
        .examples h3 {
            font-size: 1rem;
            color: var(--secondary-color);
            margin-bottom: 8px;
        }
        
        .example-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .example-btn {
            background-color: var(--light-color);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .example-btn:hover {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-deconstruct {
            background-color: var(--accent-color);
        }
        
        .btn-deconstruct:hover {
            background-color: #c0392b;
        }
        
        .results-area {
            display: flex;
            flex-direction: column;
        }
        
        .task-display {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--secondary-color);
            margin-bottom: 20px;
        }
        
        .breakdown-container {
            flex-grow: 1;
            overflow-y: auto;
            max-height: 500px;
        }
        
        .breakdown-level {
            margin-bottom: 25px;
            position: relative;
        }
        
        .level-header {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .level-title {
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .level-count {
            background-color: var(--secondary-color);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .component-list {
            padding-left: 20px;
        }
        
        .component-item {
            background-color: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            border-left: 4px solid #ddd;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        
        .component-item:hover {
            border-left-color: var(--secondary-color);
            transform: translateX(5px);
        }
        
        .component-text {
            flex-grow: 1;
        }
        
        .automation-badge {
            background-color: var(--success-color);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .automation-analysis {
            background-color: #f0f7ff;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 40px;
        }
        
        .automation-analysis h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .analysis-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            border-top: 4px solid var(--secondary-color);
        }
        
        .analysis-card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .analysis-card i {
            color: var(--secondary-color);
        }
        
        .analysis-card ul {
            padding-left: 20px;
        }
        
        .analysis-card li {
            margin-bottom: 8px;
        }
        
        .automation-potential {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .potential-bar {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            flex-grow: 1;
            margin-right: 15px;
            overflow: hidden;
        }
        
        .potential-fill {
            height: 100%;
            background-color: var(--success-color);
            border-radius: 5px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 0.9rem;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .instructions {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: var(--border-radius);
            border-left: 4px solid #ffc107;
            margin-top: 20px;
            font-size: 0.95rem;
        }
        
        .instructions h3 {
            color: #e65100;
            margin-bottom: 10px;
        }

        /* Settings Panel Styles */
        .settings-panel {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .settings-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }

        .settings-header:hover {
            background-color: #34495e;
        }

        .settings-header h3 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-toggle {
            transition: transform 0.3s;
        }

        .settings-toggle.open {
            transform: rotate(180deg);
        }

        .settings-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .settings-content.open {
            max-height: 500px;
        }

        .settings-body {
            padding: 20px;
        }

        .settings-warning {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: var(--border-radius);
            padding: 12px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .settings-warning i {
            color: #856404;
            margin-top: 2px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-group label {
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.95rem;
        }

        .setting-group input,
        .setting-group select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .setting-group input:focus,
        .setting-group select:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .setting-group input[type="password"] {
            font-family: monospace;
        }

        .settings-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 10px 18px;
            font-size: 0.9rem;
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #219a52;
        }

        /* Audio Input Section */
        .audio-section {
            margin-bottom: 40px;
        }

        .audio-section h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
        }

        .audio-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .audio-grid {
                grid-template-columns: 1fr;
            }
        }

        .audio-input-tabs {
            display: flex;
            border-bottom: 2px solid var(--light-color);
            margin-bottom: 20px;
        }

        .audio-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            color: #666;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .audio-tab:hover {
            color: var(--secondary-color);
        }

        .audio-tab.active {
            color: var(--secondary-color);
            border-bottom-color: var(--secondary-color);
            font-weight: 600;
        }

        .audio-tab-content {
            display: none;
        }

        .audio-tab-content.active {
            display: block;
        }

        /* File Upload Zone */
        .file-drop-zone {
            border: 3px dashed #ddd;
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #fafafa;
        }

        .file-drop-zone:hover,
        .file-drop-zone.dragover {
            border-color: var(--secondary-color);
            background-color: #f0f7ff;
        }

        .file-drop-zone i {
            font-size: 3rem;
            color: #bbb;
            margin-bottom: 15px;
        }

        .file-drop-zone p {
            color: #666;
            margin-bottom: 8px;
        }

        .file-drop-zone .file-types {
            font-size: 0.85rem;
            color: #999;
        }

        .file-input {
            display: none;
        }

        .selected-file {
            margin-top: 15px;
            padding: 12px;
            background-color: #e8f5e9;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .selected-file i {
            color: var(--success-color);
            margin-right: 10px;
        }

        .remove-file {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 5px;
        }

        .remove-file:hover {
            color: var(--accent-color);
        }

        /* Voice Recording */
        .recording-area {
            text-align: center;
            padding: 20px;
        }

        .record-btn {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--accent-color);
            border: none;
            color: white;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .record-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(231, 76, 60, 0.4);
        }

        .record-btn.recording {
            animation: pulse 1.5s infinite;
            background-color: #c0392b;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        .recording-status {
            font-size: 1.1rem;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .recording-time {
            font-family: monospace;
            font-size: 1.5rem;
            color: var(--accent-color);
        }

        .recording-hint {
            color: #666;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        /* Transcript Area */
        .transcript-container {
            margin-top: 20px;
        }

        .transcript-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .transcript-header h4 {
            color: var(--primary-color);
            margin: 0;
        }

        .transcript-text {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
        }

        .transcript-text:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        /* Case Intake Form */
        .intake-form-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
        }

        .intake-form-container h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .intake-section {
            margin-bottom: 25px;
        }

        .intake-section h4 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .intake-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .intake-field {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .intake-field label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
        }

        .intake-field input,
        .intake-field textarea,
        .intake-field select {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .intake-field input:focus,
        .intake-field textarea:focus,
        .intake-field select:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .intake-field textarea {
            min-height: 80px;
            resize: vertical;
        }

        .intake-field.full-width {
            grid-column: 1 / -1;
        }

        .intake-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        /* Processing Overlay */
        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .processing-overlay.active {
            display: flex;
        }

        .processing-modal {
            background-color: white;
            padding: 40px;
            border-radius: var(--border-radius);
            text-align: center;
            max-width: 400px;
        }

        .processing-modal .loading-spinner {
            margin-bottom: 20px;
        }

        .processing-modal h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .processing-modal p {
            color: #666;
        }

        /* Status Messages */
        .status-message {
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            display: none;
        }

        .status-message.show {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-message.error {
            background-color: #fdecea;
            color: #c62828;
            border: 1px solid #f5c6cb;
        }

        .status-message.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .status-message.info {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tasks"></i> Paralegal Task Deconstruction Tool</h1>
            <p class="subtitle">Demonstrate how legal tasks can be broken down into automatable components. Enter a paralegal task to see its detailed breakdown and automation potential.</p>
        </header>

        <!-- Settings Panel -->
        <div class="settings-panel">
            <div class="settings-header" onclick="toggleSettings()">
                <h3><i class="fas fa-cog"></i> API Settings</h3>
                <i class="fas fa-chevron-down settings-toggle" id="settingsToggle"></i>
            </div>
            <div class="settings-content" id="settingsContent">
                <div class="settings-body">
                    <div class="settings-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>Security Notice:</strong> API keys are stored in your browser's local storage.
                            Use dedicated API keys with spending limits. Clear keys when using shared computers.
                        </div>
                    </div>
                    <div class="settings-grid">
                        <div class="setting-group">
                            <label for="openaiKey"><i class="fas fa-key"></i> OpenAI API Key</label>
                            <input type="password" id="openaiKey" placeholder="sk-..." autocomplete="off">
                            <small style="color: #666;">Required for audio transcription (Whisper) and optional for extraction (GPT-4)</small>
                        </div>
                        <div class="setting-group">
                            <label for="anthropicKey"><i class="fas fa-key"></i> Anthropic API Key</label>
                            <input type="password" id="anthropicKey" placeholder="sk-ant-..." autocomplete="off">
                            <small style="color: #666;">Optional - for extraction with Claude</small>
                        </div>
                        <div class="setting-group">
                            <label for="extractionModel"><i class="fas fa-brain"></i> Extraction AI</label>
                            <select id="extractionModel">
                                <option value="gpt-4o">OpenAI GPT-4o</option>
                                <option value="gpt-4o-mini">OpenAI GPT-4o-mini (faster)</option>
                                <option value="claude-sonnet">Claude 3.5 Sonnet</option>
                                <option value="claude-haiku">Claude 3.5 Haiku (faster)</option>
                            </select>
                        </div>
                    </div>
                    <div class="settings-actions">
                        <button class="btn btn-small btn-success" onclick="saveSettings()">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="clearSettings()">
                            <i class="fas fa-trash"></i> Clear Keys
                        </button>
                    </div>
                    <div id="settingsStatus" class="status-message"></div>
                </div>
            </div>
        </div>

        <!-- Audio Intake Section -->
        <div class="audio-section">
            <div class="card">
                <h2><i class="fas fa-microphone-alt"></i> Audio Case Intake</h2>
                <p style="color: #666; margin-bottom: 20px;">Upload an audio file, record a voice note, or paste a transcript to extract case information.</p>

                <div class="audio-grid">
                    <!-- Left Column: Audio Input -->
                    <div>
                        <div class="audio-input-tabs">
                            <button class="audio-tab active" data-tab="upload" onclick="switchAudioTab('upload')">
                                <i class="fas fa-upload"></i> Upload
                            </button>
                            <button class="audio-tab" data-tab="record" onclick="switchAudioTab('record')">
                                <i class="fas fa-microphone"></i> Record
                            </button>
                            <button class="audio-tab" data-tab="paste" onclick="switchAudioTab('paste')">
                                <i class="fas fa-paste"></i> Paste
                            </button>
                        </div>

                        <!-- Upload Tab -->
                        <div class="audio-tab-content active" id="tab-upload">
                            <div class="file-drop-zone" id="dropZone" onclick="document.getElementById('audioFile').click()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Drag & drop audio file here or click to browse</p>
                                <span class="file-types">Supports: MP3, WAV, M4A, WebM, MP4 (max 25MB)</span>
                            </div>
                            <input type="file" id="audioFile" class="file-input" accept="audio/*,.mp3,.wav,.m4a,.webm,.mp4">
                            <div id="selectedFileDisplay" class="selected-file" style="display: none;">
                                <span><i class="fas fa-file-audio"></i> <span id="selectedFileName"></span></span>
                                <button class="remove-file" onclick="removeSelectedFile()"><i class="fas fa-times"></i></button>
                            </div>
                        </div>

                        <!-- Record Tab -->
                        <div class="audio-tab-content" id="tab-record">
                            <div class="recording-area">
                                <button class="record-btn" id="recordBtn" onclick="toggleRecording()">
                                    <i class="fas fa-microphone" id="recordIcon"></i>
                                </button>
                                <p class="recording-status" id="recordingStatus">Click to start recording</p>
                                <p class="recording-time" id="recordingTime">00:00</p>
                                <p class="recording-hint">Maximum recording time: 5 minutes</p>
                            </div>
                        </div>

                        <!-- Paste Tab -->
                        <div class="audio-tab-content" id="tab-paste">
                            <textarea id="pasteTranscript" class="transcript-text" placeholder="Paste your transcript here (from Otter.ai, meeting notes, or any other source)..."></textarea>
                            <button class="btn btn-small" style="margin-top: 15px;" onclick="useTranscript(document.getElementById('pasteTranscript').value)">
                                <i class="fas fa-arrow-right"></i> Use This Transcript
                            </button>
                        </div>

                        <!-- Transcribe Button -->
                        <button class="btn btn-deconstruct" id="transcribeBtn" style="margin-top: 20px; width: 100%;" onclick="transcribeAudio()">
                            <i class="fas fa-language"></i> Transcribe Audio
                        </button>

                        <div id="audioStatus" class="status-message"></div>

                        <!-- Transcript Display -->
                        <div class="transcript-container" id="transcriptContainer" style="display: none;">
                            <div class="transcript-header">
                                <h4><i class="fas fa-file-alt"></i> Transcript</h4>
                                <button class="btn btn-small btn-success" onclick="extractCaseInfo()">
                                    <i class="fas fa-magic"></i> Extract Case Info
                                </button>
                            </div>
                            <textarea id="transcriptText" class="transcript-text" placeholder="Transcript will appear here..."></textarea>
                        </div>
                    </div>

                    <!-- Right Column: Case Intake Form -->
                    <div class="intake-form-container" id="intakeFormContainer">
                        <h3><i class="fas fa-clipboard-list"></i> Case Information</h3>

                        <!-- Client Information -->
                        <div class="intake-section">
                            <h4><i class="fas fa-user"></i> Client Information</h4>
                            <div class="intake-grid">
                                <div class="intake-field">
                                    <label>Full Name</label>
                                    <input type="text" id="clientName" placeholder="Enter client name">
                                </div>
                                <div class="intake-field">
                                    <label>Phone</label>
                                    <input type="tel" id="clientPhone" placeholder="(555) 555-5555">
                                </div>
                                <div class="intake-field">
                                    <label>Email</label>
                                    <input type="email" id="clientEmail" placeholder="client@email.com">
                                </div>
                                <div class="intake-field">
                                    <label>Date of Birth</label>
                                    <input type="date" id="clientDOB">
                                </div>
                                <div class="intake-field full-width">
                                    <label>Address</label>
                                    <input type="text" id="clientAddress" placeholder="Full address">
                                </div>
                            </div>
                        </div>

                        <!-- Case Details -->
                        <div class="intake-section">
                            <h4><i class="fas fa-gavel"></i> Case Details</h4>
                            <div class="intake-grid">
                                <div class="intake-field">
                                    <label>Case Type</label>
                                    <select id="caseType">
                                        <option value="">Select type...</option>
                                        <option value="personal-injury">Personal Injury</option>
                                        <option value="car-accident">Car Accident</option>
                                        <option value="medical-malpractice">Medical Malpractice</option>
                                        <option value="slip-fall">Slip and Fall</option>
                                        <option value="wrongful-death">Wrongful Death</option>
                                        <option value="employment">Employment</option>
                                        <option value="contract">Contract Dispute</option>
                                        <option value="family">Family Law</option>
                                        <option value="criminal">Criminal Defense</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="intake-field">
                                    <label>Incident Date</label>
                                    <input type="date" id="incidentDate">
                                </div>
                                <div class="intake-field">
                                    <label>Incident Location</label>
                                    <input type="text" id="incidentLocation" placeholder="City, State">
                                </div>
                                <div class="intake-field">
                                    <label>Jurisdiction</label>
                                    <input type="text" id="jurisdiction" placeholder="County/State">
                                </div>
                            </div>
                        </div>

                        <!-- Parties Involved -->
                        <div class="intake-section">
                            <h4><i class="fas fa-users"></i> Parties Involved</h4>
                            <div class="intake-grid">
                                <div class="intake-field full-width">
                                    <label>Defendants/Opposing Parties</label>
                                    <textarea id="defendants" placeholder="List all defendants or opposing parties..."></textarea>
                                </div>
                                <div class="intake-field full-width">
                                    <label>Witnesses</label>
                                    <textarea id="witnesses" placeholder="List any known witnesses with contact info if available..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Facts & Narrative -->
                        <div class="intake-section">
                            <h4><i class="fas fa-book"></i> Case Facts</h4>
                            <div class="intake-grid">
                                <div class="intake-field full-width">
                                    <label>Narrative Summary</label>
                                    <textarea id="narrativeSummary" placeholder="Chronological summary of events..." style="min-height: 120px;"></textarea>
                                </div>
                                <div class="intake-field full-width">
                                    <label>Key Events</label>
                                    <textarea id="keyEvents" placeholder="List key events and dates..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Damages -->
                        <div class="intake-section">
                            <h4><i class="fas fa-notes-medical"></i> Damages</h4>
                            <div class="intake-grid">
                                <div class="intake-field full-width">
                                    <label>Physical Injuries</label>
                                    <textarea id="physicalInjuries" placeholder="Describe any physical injuries..."></textarea>
                                </div>
                                <div class="intake-field">
                                    <label>Property Damage</label>
                                    <input type="text" id="propertyDamage" placeholder="Describe property damage">
                                </div>
                                <div class="intake-field">
                                    <label>Financial Losses</label>
                                    <input type="text" id="financialLosses" placeholder="Lost wages, medical bills, etc.">
                                </div>
                            </div>
                        </div>

                        <!-- Evidence & Urgency -->
                        <div class="intake-section">
                            <h4><i class="fas fa-folder-open"></i> Evidence & Urgency</h4>
                            <div class="intake-grid">
                                <div class="intake-field full-width">
                                    <label>Available Evidence</label>
                                    <textarea id="availableEvidence" placeholder="List any documents, photos, records mentioned..."></textarea>
                                </div>
                                <div class="intake-field full-width">
                                    <label>Urgency / Statute of Limitations Concerns</label>
                                    <textarea id="urgencyNotes" placeholder="Any time-sensitive matters or deadlines..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="intake-actions">
                            <button class="btn btn-small" onclick="copyIntakeToClipboard()">
                                <i class="fas fa-copy"></i> Copy to Clipboard
                            </button>
                            <button class="btn btn-small btn-secondary" onclick="downloadIntakeJSON()">
                                <i class="fas fa-download"></i> Download JSON
                            </button>
                            <button class="btn btn-small btn-secondary" onclick="clearIntakeForm()">
                                <i class="fas fa-eraser"></i> Clear Form
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Processing Overlay -->
        <div class="processing-overlay" id="processingOverlay">
            <div class="processing-modal">
                <div class="loading-spinner"></div>
                <h3 id="processingTitle">Processing...</h3>
                <p id="processingMessage">Please wait while we process your request.</p>
            </div>
        </div>
        
        <div class="main-content">
            <div class="card">
                <h2><i class="fas fa-keyboard"></i> Enter Paralegal Task</h2>
                <div class="input-area">
                    <div class="task-input-container">
                        <label for="taskInput">Describe a paralegal task you'd like to deconstruct:</label>
                        <textarea id="taskInput" placeholder="Example: Draft a complaint for a civil lawsuit..."></textarea>
                    </div>
                    
                    <div class="examples">
                        <h3>Try these example tasks:</h3>
                        <div class="example-list">
                            <button class="example-btn" data-example="Draft a complaint for a civil lawsuit">Draft Complaint</button>
                            <button class="example-btn" data-example="Conduct document review for discovery">Document Review</button>
                            <button class="example-btn" data-example="Prepare deposition summaries">Deposition Summaries</button>
                            <button class="example-btn" data-example="File court documents electronically">E-Filing</button>
                            <button class="example-btn" data-example="Prepare trial exhibit binders">Trial Exhibits</button>
                        </div>
                    </div>
                    
                    <button id="deconstructBtn" class="btn btn-deconstruct">
                        <i class="fas fa-cogs"></i> Deconstruct Task
                    </button>
                </div>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> How It Works</h3>
                    <p>This tool demonstrates how complex paralegal tasks can be broken down into smaller, manageable components. Each component is analyzed for automation potential, showing how legal technology can streamline paralegal work.</p>
                </div>
            </div>
            
            <div class="card results-area">
                <h2><i class="fas fa-project-diagram"></i> Task Breakdown</h2>
                
                <div class="loading" id="loadingIndicator">
                    <div class="loading-spinner"></div>
                    <p>Analyzing task components...</p>
                </div>
                
                <div id="resultsContainer">
                    <div class="task-display" id="taskDisplay">
                        <p><strong>Your Task:</strong> <span id="currentTask">Enter a task above to see the breakdown</span></p>
                    </div>
                    
                    <div class="breakdown-container" id="breakdownContainer">
                        <p class="instructions">The task breakdown will appear here after you click "Deconstruct Task".</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="automation-analysis" id="automationAnalysis" style="display: none;">
            <h2><i class="fas fa-robot"></i> Automation Analysis</h2>
            <p>Based on the task breakdown, here's how automation could be implemented:</p>
            
            <div class="analysis-grid" id="analysisGrid">
                <!-- Analysis cards will be inserted here -->
            </div>
        </div>
        
        <footer>
            <p>Paralegal Task Deconstruction Tool | Designed to demonstrate task analysis for automation potential</p>
            <p>This tool is for demonstration purposes and does not constitute legal advice.</p>
        </footer>
    </div>

    <script>
        // ============================================
        // AUDIO INTAKE & SETTINGS FUNCTIONALITY
        // ============================================

        // Global state for audio recording
        let mediaRecorder = null;
        let audioChunks = [];
        let recordingTimer = null;
        let recordingSeconds = 0;
        let selectedAudioFile = null;
        let recordedAudioBlob = null;

        // Settings Management
        function toggleSettings() {
            const content = document.getElementById('settingsContent');
            const toggle = document.getElementById('settingsToggle');
            content.classList.toggle('open');
            toggle.classList.toggle('open');
        }

        function saveSettings() {
            const openaiKey = document.getElementById('openaiKey').value.trim();
            const anthropicKey = document.getElementById('anthropicKey').value.trim();
            const extractionModel = document.getElementById('extractionModel').value;

            localStorage.setItem('paralegal_openai_key', openaiKey);
            localStorage.setItem('paralegal_anthropic_key', anthropicKey);
            localStorage.setItem('paralegal_extraction_model', extractionModel);

            showStatus('settingsStatus', 'Settings saved successfully!', 'success');
        }

        function loadSettings() {
            const openaiKey = localStorage.getItem('paralegal_openai_key') || '';
            const anthropicKey = localStorage.getItem('paralegal_anthropic_key') || '';
            const extractionModel = localStorage.getItem('paralegal_extraction_model') || 'gpt-4o';

            document.getElementById('openaiKey').value = openaiKey;
            document.getElementById('anthropicKey').value = anthropicKey;
            document.getElementById('extractionModel').value = extractionModel;

            // If keys exist, show a visual indicator
            if (openaiKey || anthropicKey) {
                document.getElementById('settingsContent').classList.add('open');
                document.getElementById('settingsToggle').classList.add('open');
            }
        }

        function clearSettings() {
            if (confirm('Are you sure you want to clear all API keys?')) {
                localStorage.removeItem('paralegal_openai_key');
                localStorage.removeItem('paralegal_anthropic_key');
                document.getElementById('openaiKey').value = '';
                document.getElementById('anthropicKey').value = '';
                showStatus('settingsStatus', 'API keys cleared.', 'info');
            }
        }

        function showStatus(elementId, message, type) {
            const statusEl = document.getElementById(elementId);
            statusEl.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${message}`;
            statusEl.className = `status-message show ${type}`;
            setTimeout(() => {
                statusEl.classList.remove('show');
            }, 5000);
        }

        // Audio Tab Switching
        function switchAudioTab(tabName) {
            document.querySelectorAll('.audio-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.audio-tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // File Upload Handling
        function setupFileUpload() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('audioFile');

            // Drag and drop events
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'));
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'));
            });

            dropZone.addEventListener('drop', (e) => {
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });
        }

        function handleFileSelect(file) {
            const maxSize = 25 * 1024 * 1024; // 25MB
            const allowedTypes = ['audio/mpeg', 'audio/wav', 'audio/mp4', 'audio/m4a', 'audio/webm', 'video/mp4', 'video/webm'];

            if (file.size > maxSize) {
                showStatus('audioStatus', 'File is too large. Maximum size is 25MB.', 'error');
                return;
            }

            selectedAudioFile = file;
            recordedAudioBlob = null; // Clear any recorded audio

            document.getElementById('selectedFileName').textContent = file.name;
            document.getElementById('selectedFileDisplay').style.display = 'flex';
            document.getElementById('dropZone').style.display = 'none';
        }

        function removeSelectedFile() {
            selectedAudioFile = null;
            document.getElementById('audioFile').value = '';
            document.getElementById('selectedFileDisplay').style.display = 'none';
            document.getElementById('dropZone').style.display = 'block';
        }

        // Voice Recording
        async function toggleRecording() {
            const recordBtn = document.getElementById('recordBtn');
            const recordIcon = document.getElementById('recordIcon');
            const recordingStatus = document.getElementById('recordingStatus');

            if (mediaRecorder && mediaRecorder.state === 'recording') {
                // Stop recording
                mediaRecorder.stop();
                recordBtn.classList.remove('recording');
                recordIcon.className = 'fas fa-microphone';
                recordingStatus.textContent = 'Recording saved';
                clearInterval(recordingTimer);
            } else {
                // Start recording
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = (e) => {
                        audioChunks.push(e.data);
                    };

                    mediaRecorder.onstop = () => {
                        recordedAudioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        selectedAudioFile = null; // Clear any uploaded file
                        stream.getTracks().forEach(track => track.stop());
                    };

                    mediaRecorder.start();
                    recordBtn.classList.add('recording');
                    recordIcon.className = 'fas fa-stop';
                    recordingStatus.textContent = 'Recording...';
                    recordingSeconds = 0;
                    updateRecordingTime();

                    recordingTimer = setInterval(() => {
                        recordingSeconds++;
                        updateRecordingTime();
                        // Auto-stop at 5 minutes
                        if (recordingSeconds >= 300) {
                            toggleRecording();
                        }
                    }, 1000);
                } catch (err) {
                    showStatus('audioStatus', 'Could not access microphone. Please check permissions.', 'error');
                }
            }
        }

        function updateRecordingTime() {
            const minutes = Math.floor(recordingSeconds / 60);
            const seconds = recordingSeconds % 60;
            document.getElementById('recordingTime').textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Transcription
        async function transcribeAudio() {
            const openaiKey = localStorage.getItem('paralegal_openai_key');

            if (!openaiKey) {
                showStatus('audioStatus', 'Please add your OpenAI API key in Settings.', 'error');
                toggleSettings();
                return;
            }

            let audioToTranscribe = selectedAudioFile || recordedAudioBlob;

            if (!audioToTranscribe) {
                showStatus('audioStatus', 'Please upload an audio file or record a voice note first.', 'error');
                return;
            }

            showProcessing('Transcribing Audio', 'Converting speech to text using OpenAI Whisper...');

            try {
                const formData = new FormData();
                formData.append('file', audioToTranscribe, audioToTranscribe.name || 'recording.webm');
                formData.append('model', 'whisper-1');

                const response = await fetch('https://api.openai.com/v1/audio/transcriptions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${openaiKey}`
                    },
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Transcription failed');
                }

                const result = await response.json();
                useTranscript(result.text);
                hideProcessing();
                showStatus('audioStatus', 'Transcription complete!', 'success');
            } catch (err) {
                hideProcessing();
                showStatus('audioStatus', `Error: ${err.message}`, 'error');
            }
        }

        function useTranscript(text) {
            if (!text || !text.trim()) {
                showStatus('audioStatus', 'No transcript text provided.', 'error');
                return;
            }

            document.getElementById('transcriptText').value = text;
            document.getElementById('transcriptContainer').style.display = 'block';
        }

        // AI Extraction
        async function extractCaseInfo() {
            const transcript = document.getElementById('transcriptText').value.trim();

            if (!transcript) {
                showStatus('audioStatus', 'No transcript to extract from.', 'error');
                return;
            }

            const extractionModel = localStorage.getItem('paralegal_extraction_model') || 'gpt-4o';
            const isClaudeModel = extractionModel.startsWith('claude');

            const apiKey = isClaudeModel
                ? localStorage.getItem('paralegal_anthropic_key')
                : localStorage.getItem('paralegal_openai_key');

            if (!apiKey) {
                const provider = isClaudeModel ? 'Anthropic' : 'OpenAI';
                showStatus('audioStatus', `Please add your ${provider} API key in Settings.`, 'error');
                toggleSettings();
                return;
            }

            showProcessing('Extracting Case Information', `Analyzing transcript with ${extractionModel}...`);

            const extractionPrompt = `You are a legal intake specialist. Analyze the following transcript from a client consultation and extract all relevant case information.

Return your response as a JSON object with exactly these fields (use empty string if information is not available):

{
    "clientName": "Full name of the client",
    "clientPhone": "Phone number",
    "clientEmail": "Email address",
    "clientDOB": "Date of birth in YYYY-MM-DD format",
    "clientAddress": "Full address",
    "caseType": "One of: personal-injury, car-accident, medical-malpractice, slip-fall, wrongful-death, employment, contract, family, criminal, other",
    "incidentDate": "Date of incident in YYYY-MM-DD format",
    "incidentLocation": "City, State where incident occurred",
    "jurisdiction": "County/State for jurisdiction",
    "defendants": "Names and descriptions of defendants or opposing parties",
    "witnesses": "Names and contact info of any witnesses mentioned",
    "narrativeSummary": "A chronological summary of what happened",
    "keyEvents": "Bullet points of key events with dates",
    "physicalInjuries": "Description of physical injuries",
    "propertyDamage": "Description of property damage",
    "financialLosses": "Lost wages, medical bills, other financial losses",
    "availableEvidence": "Documents, photos, records mentioned",
    "urgencyNotes": "Any statute of limitations concerns or urgent matters"
}

TRANSCRIPT:
${transcript}

Respond with ONLY the JSON object, no additional text.`;

            try {
                let result;

                if (isClaudeModel) {
                    const modelId = extractionModel === 'claude-sonnet' ? 'claude-sonnet-4-20250514' : 'claude-3-5-haiku-20241022';

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey,
                            'anthropic-version': '2023-06-01',
                            'anthropic-dangerous-direct-browser-access': 'true'
                        },
                        body: JSON.stringify({
                            model: modelId,
                            max_tokens: 4096,
                            messages: [{
                                role: 'user',
                                content: extractionPrompt
                            }]
                        })
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error?.message || 'Extraction failed');
                    }

                    const data = await response.json();
                    result = JSON.parse(data.content[0].text);
                } else {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: extractionModel,
                            messages: [{
                                role: 'user',
                                content: extractionPrompt
                            }],
                            response_format: { type: 'json_object' }
                        })
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error?.message || 'Extraction failed');
                    }

                    const data = await response.json();
                    result = JSON.parse(data.choices[0].message.content);
                }

                populateIntakeForm(result);
                hideProcessing();
                showStatus('audioStatus', 'Case information extracted successfully!', 'success');
            } catch (err) {
                hideProcessing();
                showStatus('audioStatus', `Extraction error: ${err.message}`, 'error');
            }
        }

        function populateIntakeForm(data) {
            const fieldMappings = {
                clientName: 'clientName',
                clientPhone: 'clientPhone',
                clientEmail: 'clientEmail',
                clientDOB: 'clientDOB',
                clientAddress: 'clientAddress',
                caseType: 'caseType',
                incidentDate: 'incidentDate',
                incidentLocation: 'incidentLocation',
                jurisdiction: 'jurisdiction',
                defendants: 'defendants',
                witnesses: 'witnesses',
                narrativeSummary: 'narrativeSummary',
                keyEvents: 'keyEvents',
                physicalInjuries: 'physicalInjuries',
                propertyDamage: 'propertyDamage',
                financialLosses: 'financialLosses',
                availableEvidence: 'availableEvidence',
                urgencyNotes: 'urgencyNotes'
            };

            for (const [dataKey, elementId] of Object.entries(fieldMappings)) {
                const element = document.getElementById(elementId);
                if (element && data[dataKey]) {
                    element.value = data[dataKey];
                }
            }
        }

        // Form Actions
        function getIntakeFormData() {
            return {
                client: {
                    name: document.getElementById('clientName').value,
                    phone: document.getElementById('clientPhone').value,
                    email: document.getElementById('clientEmail').value,
                    dob: document.getElementById('clientDOB').value,
                    address: document.getElementById('clientAddress').value
                },
                case: {
                    type: document.getElementById('caseType').value,
                    incidentDate: document.getElementById('incidentDate').value,
                    incidentLocation: document.getElementById('incidentLocation').value,
                    jurisdiction: document.getElementById('jurisdiction').value
                },
                parties: {
                    defendants: document.getElementById('defendants').value,
                    witnesses: document.getElementById('witnesses').value
                },
                facts: {
                    narrative: document.getElementById('narrativeSummary').value,
                    keyEvents: document.getElementById('keyEvents').value
                },
                damages: {
                    physicalInjuries: document.getElementById('physicalInjuries').value,
                    propertyDamage: document.getElementById('propertyDamage').value,
                    financialLosses: document.getElementById('financialLosses').value
                },
                evidence: {
                    available: document.getElementById('availableEvidence').value,
                    urgency: document.getElementById('urgencyNotes').value
                },
                extractedAt: new Date().toISOString()
            };
        }

        function copyIntakeToClipboard() {
            const data = getIntakeFormData();
            const text = formatIntakeAsText(data);

            navigator.clipboard.writeText(text).then(() => {
                showStatus('audioStatus', 'Case information copied to clipboard!', 'success');
            }).catch(() => {
                showStatus('audioStatus', 'Failed to copy to clipboard.', 'error');
            });
        }

        function formatIntakeAsText(data) {
            return `CASE INTAKE INFORMATION
========================

CLIENT INFORMATION
------------------
Name: ${data.client.name}
Phone: ${data.client.phone}
Email: ${data.client.email}
Date of Birth: ${data.client.dob}
Address: ${data.client.address}

CASE DETAILS
------------
Case Type: ${data.case.type}
Incident Date: ${data.case.incidentDate}
Incident Location: ${data.case.incidentLocation}
Jurisdiction: ${data.case.jurisdiction}

PARTIES INVOLVED
----------------
Defendants/Opposing Parties:
${data.parties.defendants}

Witnesses:
${data.parties.witnesses}

CASE FACTS
----------
Narrative Summary:
${data.facts.narrative}

Key Events:
${data.facts.keyEvents}

DAMAGES
-------
Physical Injuries:
${data.damages.physicalInjuries}

Property Damage: ${data.damages.propertyDamage}
Financial Losses: ${data.damages.financialLosses}

EVIDENCE & URGENCY
------------------
Available Evidence:
${data.evidence.available}

Urgency Notes:
${data.evidence.urgency}

---
Extracted: ${new Date(data.extractedAt).toLocaleString()}`;
        }

        function downloadIntakeJSON() {
            const data = getIntakeFormData();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `case-intake-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function clearIntakeForm() {
            if (confirm('Are you sure you want to clear all form fields?')) {
                const fields = ['clientName', 'clientPhone', 'clientEmail', 'clientDOB', 'clientAddress',
                    'caseType', 'incidentDate', 'incidentLocation', 'jurisdiction',
                    'defendants', 'witnesses', 'narrativeSummary', 'keyEvents',
                    'physicalInjuries', 'propertyDamage', 'financialLosses',
                    'availableEvidence', 'urgencyNotes'];

                fields.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.value = '';
                });
            }
        }

        // Processing Overlay
        function showProcessing(title, message) {
            document.getElementById('processingTitle').textContent = title;
            document.getElementById('processingMessage').textContent = message;
            document.getElementById('processingOverlay').classList.add('active');
        }

        function hideProcessing() {
            document.getElementById('processingOverlay').classList.remove('active');
        }

        // Initialize audio functionality
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            setupFileUpload();
        });

        // ============================================
        // ORIGINAL TASK DECONSTRUCTION FUNCTIONALITY
        // ============================================

        // Example tasks data
        const exampleTasks = {
            "Draft a complaint for a civil lawsuit": {
                level1: [
                    "Review case facts and client information",
                    "Identify proper jurisdiction and venue",
                    "Determine causes of action",
                    "Research applicable laws and precedents",
                    "Draft caption and parties section",
                    "Write factual allegations",
                    "Formulate legal claims",
                    "Draft prayer for relief",
                    "Include verification if required",
                    "Format according to court rules"
                ],
                level2: {
                    "Draft factual allegations": [
                        "Chronologically organize events",
                        "Include specific dates and locations",
                        "Identify all relevant parties",
                        "Describe actions and consequences",
                        "Cite supporting evidence",
                        "Ensure factual consistency"
                    ],
                    "Formulate legal claims": [
                        "Match facts to legal elements",
                        "Cite relevant statutes",
                        "Reference applicable case law",
                        "Avoid redundant claims",
                        "Check statute of limitations",
                        "Include all necessary parties"
                    ]
                },
                automation: [
                    {
                        title: "Document Assembly",
                        icon: "fas fa-file-contract",
                        description: "Automate repetitive drafting tasks",
                        components: ["Draft caption and parties section", "Format according to court rules", "Include verification if required"],
                        tools: ["Document automation software", "Template libraries", "Style checkers"],
                        potential: 85
                    },
                    {
                        title: "Legal Research",
                        icon: "fas fa-search",
                        description: "Streamline research processes",
                        components: ["Research applicable laws and precedents", "Cite relevant statutes", "Reference applicable case law"],
                        tools: ["AI-powered research tools", "Citation generators", "Statute databases"],
                        potential: 75
                    },
                    {
                        title: "Fact Organization",
                        icon: "fas fa-sitemap",
                        description: "Structure case facts efficiently",
                        components: ["Chronologically organize events", "Identify all relevant parties", "Ensure factual consistency"],
                        tools: ["Case management systems", "Timeline builders", "Fact organization software"],
                        potential: 70
                    }
                ]
            },
            "Conduct document review for discovery": {
                level1: [
                    "Receive document production from opposing party",
                    "Organize documents by source and date",
                    "Apply relevance criteria to filter documents",
                    "Identify privileged materials",
                    "Flag key documents for case strategy",
                    "Code documents for easy retrieval",
                    "Prepare document summaries",
                    "Identify patterns and connections",
                    "Prepare privilege log",
                    "Generate review report"
                ],
                level2: {
                    "Apply relevance criteria": [
                        "Review document against discovery requests",
                        "Identify responsive materials",
                        "Separate non-responsive documents",
                        "Apply keyword filters",
                        "Check for date range relevance",
                        "Evaluate subject matter relevance"
                    ],
                    "Code documents for easy retrieval": [
                        "Assign unique identifiers",
                        "Apply issue tags",
                        "Note key facts or evidence",
                        "Mark witness connections",
                        "Flag for attorney review",
                        "Create cross-references"
                    ]
                },
                automation: [
                    {
                        title: "Document Analysis",
                        icon: "fas fa-file-alt",
                        description: "Automate initial document screening",
                        components: ["Apply keyword filters", "Check for date range relevance", "Separate non-responsive documents"],
                        tools: ["AI document review platforms", "Predictive coding", "Text analytics tools"],
                        potential: 90
                    },
                    {
                        title: "Organization & Tagging",
                        icon: "fas fa-tags",
                        description: "Systematize document categorization",
                        components: ["Assign unique identifiers", "Apply issue tags", "Create cross-references"],
                        tools: ["Document management systems", "Automated tagging software", "Metadata extractors"],
                        potential: 80
                    },
                    {
                        title: "Reporting",
                        icon: "fas fa-chart-bar",
                        description: "Generate review summaries automatically",
                        components: ["Prepare document summaries", "Generate review report", "Identify patterns and connections"],
                        tools: ["Report generators", "Data visualization tools", "Analytics dashboards"],
                        potential: 75
                    }
                ]
            },
            "Prepare deposition summaries": {
                level1: [
                    "Review deposition transcript",
                    "Identify key testimony sections",
                    "Highlight admissions and contradictions",
                    "Note objections and rulings",
                    "Extract quotes for potential use",
                    "Summarize each major topic",
                    "Create index of important topics",
                    "Cross-reference with other evidence",
                    "Format for attorney review",
                    "Prepare condensed version for trial"
                ],
                level2: {
                    "Identify key testimony sections": [
                        "Locate answers to important questions",
                        "Find admissions against interest",
                        "Identify inconsistencies in testimony",
                        "Note evasive or non-responsive answers",
                        "Highlight helpful statements",
                        "Flag damaging testimony"
                    ],
                    "Summarize each major topic": [
                        "Paraphrase lengthy testimony",
                        "Maintain original meaning",
                        "Include page and line references",
                        "Note attorney questions",
                        "Connect related testimony",
                        "Indicate significance to case"
                    ]
                },
                automation: [
                    {
                        title: "Transcript Analysis",
                        icon: "fas fa-comment-dots",
                        description: "Automate review of deposition transcripts",
                        components: ["Identify admissions and contradictions", "Find inconsistencies in testimony", "Highlight helpful statements"],
                        tools: ["AI transcript analyzers", "Natural language processing", "Keyword highlighters"],
                        potential: 80
                    },
                    {
                        title: "Summary Generation",
                        icon: "fas fa-file-signature",
                        description: "Create draft summaries automatically",
                        components: ["Paraphrase lengthy testimony", "Create index of important topics", "Format for attorney review"],
                        tools: ["Summary generation software", "Template-based summarizers", "Automated formatting tools"],
                        potential: 70
                    },
                    {
                        title: "Cross-referencing",
                        icon: "fas fa-link",
                        description: "Connect testimony to other evidence",
                        components: ["Cross-reference with other evidence", "Connect related testimony", "Flag for attorney review"],
                        tools: ["Case linking software", "Evidence correlation tools", "Database connectors"],
                        potential: 65
                    }
                ]
            }
        };

        // DOM elements
        const taskInput = document.getElementById('taskInput');
        const deconstructBtn = document.getElementById('deconstructBtn');
        const exampleBtns = document.querySelectorAll('.example-btn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultsContainer = document.getElementById('resultsContainer');
        const taskDisplay = document.getElementById('currentTask');
        const breakdownContainer = document.getElementById('breakdownContainer');
        const automationAnalysis = document.getElementById('automationAnalysis');
        const analysisGrid = document.getElementById('analysisGrid');

        // Event listeners
        deconstructBtn.addEventListener('click', deconstructTask);
        
        exampleBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const exampleText = this.getAttribute('data-example');
                taskInput.value = exampleText;
                deconstructTask();
            });
        });

        // Main function to deconstruct the task
        function deconstructTask() {
            const task = taskInput.value.trim();
            
            if (!task) {
                alert("Please enter a task to deconstruct.");
                taskInput.focus();
                return;
            }
            
            // Show loading indicator
            loadingIndicator.style.display = 'block';
            resultsContainer.style.display = 'none';
            automationAnalysis.style.display = 'none';
            
            // Simulate processing time
            setTimeout(() => {
                processTask(task);
                loadingIndicator.style.display = 'none';
                resultsContainer.style.display = 'block';
            }, 800);
        }

        function processTask(task) {
            // Display the task
            taskDisplay.textContent = task;
            
            // Clear previous breakdown
            breakdownContainer.innerHTML = '';
            
            // Check if task is in our examples
            let taskData;
            if (exampleTasks[task]) {
                taskData = exampleTasks[task];
            } else {
                // Generate generic breakdown for unknown tasks
                taskData = generateGenericBreakdown(task);
            }
            
            // Create level 1 breakdown
            createBreakdownLevel("Primary Components", taskData.level1, 1);
            
            // Create level 2 breakdown if available
            if (taskData.level2) {
                for (const [category, components] of Object.entries(taskData.level2)) {
                    createBreakdownLevel(category, components, 2);
                }
            }
            
            // Add automation analysis if available
            if (taskData.automation) {
                createAutomationAnalysis(taskData.automation);
                automationAnalysis.style.display = 'block';
            }
            
            // Scroll to results
            breakdownContainer.scrollTop = 0;
        }

        function createBreakdownLevel(title, components, level) {
            const levelDiv = document.createElement('div');
            levelDiv.className = 'breakdown-level';
            
            const headerDiv = document.createElement('div');
            headerDiv.className = 'level-header';
            
            const titleSpan = document.createElement('span');
            titleSpan.className = 'level-title';
            titleSpan.textContent = title;
            
            const countSpan = document.createElement('span');
            countSpan.className = 'level-count';
            countSpan.textContent = `${components.length} components`;
            
            headerDiv.appendChild(titleSpan);
            headerDiv.appendChild(countSpan);
            
            const listDiv = document.createElement('div');
            listDiv.className = 'component-list';
            
            components.forEach(component => {
                const componentDiv = document.createElement('div');
                componentDiv.className = 'component-item';
                
                const textDiv = document.createElement('div');
                textDiv.className = 'component-text';
                textDiv.textContent = component;
                
                componentDiv.appendChild(textDiv);
                
                // Randomly assign some components as automatable
                if (Math.random() > 0.6) {
                    const badge = document.createElement('span');
                    badge.className = 'automation-badge';
                    badge.textContent = 'Automatable';
                    componentDiv.appendChild(badge);
                }
                
                listDiv.appendChild(componentDiv);
            });
            
            levelDiv.appendChild(headerDiv);
            levelDiv.appendChild(listDiv);
            
            breakdownContainer.appendChild(levelDiv);
        }

        function createAutomationAnalysis(automationData) {
            analysisGrid.innerHTML = '';
            
            automationData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'analysis-card';
                
                card.innerHTML = `
                    <h3><i class="${item.icon}"></i> ${item.title}</h3>
                    <p>${item.description}</p>
                    <p><strong>Components automated:</strong></p>
                    <ul>
                        ${item.components.map(comp => `<li>${comp}</li>`).join('')}
                    </ul>
                    <p><strong>Tools needed:</strong> ${item.tools.join(', ')}</p>
                    <div class="automation-potential">
                        <div class="potential-bar">
                            <div class="potential-fill" style="width: ${item.potential}%"></div>
                        </div>
                        <span>${item.potential}% automatable</span>
                    </div>
                `;
                
                analysisGrid.appendChild(card);
            });
        }

        function generateGenericBreakdown(task) {
            // Generate a generic breakdown for tasks not in our examples
            const words = task.split(' ');
            const action = words[0]; // First word is usually the action
            
            const genericBreakdown = {
                level1: [
                    `Gather requirements for ${task.toLowerCase()}`,
                    `Research relevant laws and regulations`,
                    `Collect necessary documents and information`,
                    `Analyze facts and apply to legal standards`,
                    `Draft initial ${action === 'Draft' ? 'document' : 'materials'}`,
                    `Review for accuracy and completeness`,
                    `Format according to legal standards`,
                    `Obtain necessary approvals`,
                    `Finalize and prepare for distribution`,
                    `Document the process for future reference`
                ],
                level2: {
                    "Research phase": [
                        "Identify applicable jurisdiction",
                        "Review relevant statutes",
                        "Check for recent case law",
                        "Consult secondary sources",
                        "Verify procedural requirements",
                        "Document research findings"
                    ],
                    "Drafting phase": [
                        "Create outline of key points",
                        "Incorporate legal standards",
                        "Apply facts to law",
                        "Include necessary elements",
                        "Use appropriate legal language",
                        "Cite authorities properly"
                    ]
                },
                automation: [
                    {
                        title: "Research Automation",
                        icon: "fas fa-search",
                        description: "Streamline legal research processes",
                        components: ["Research relevant laws and regulations", "Check for recent case law", "Document research findings"],
                        tools: ["AI research assistants", "Legal databases", "Citation managers"],
                        potential: 70
                    },
                    {
                        title: "Document Assembly",
                        icon: "fas fa-file-contract",
                        description: "Automate document creation",
                        components: ["Draft initial materials", "Format according to legal standards", "Include necessary elements"],
                        tools: ["Document automation software", "Template systems", "Style checkers"],
                        potential: 75
                    },
                    {
                        title: "Process Management",
                        icon: "fas fa-stream",
                        description: "Systematize workflow and tracking",
                        components: ["Document the process for future reference", "Obtain necessary approvals", "Prepare for distribution"],
                        tools: ["Workflow management systems", "Approval trackers", "Document management platforms"],
                        potential: 65
                    }
                ]
            };
            
            return genericBreakdown;
        }

        // Initialize with an example
        document.addEventListener('DOMContentLoaded', function() {
            taskInput.value = "Draft a complaint for a civil lawsuit";
            deconstructTask();
        });
    </script>
</body>
</html>